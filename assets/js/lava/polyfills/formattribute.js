// Generated by CoffeeScript 1.3.3

/*
Form Attribute
*/


(function() {

  (function($, Modernizr) {
    var methods, namespace;
    methods = {};
    namespace = 'lavaPolyfill.lavaFormattrribute';
    Modernizr.addTest('formattribute', function() {
      var bool, div, form, id, input;
      try {
        form = document.createElement("form");
        input = document.createElement("input");
        div = document.createElement("div");
        id = "formtest";
        bool = false;
        form.id = id;
        input.setAttribute("form", id);
        div.appendChild(form);
        div.appendChild(input);
        document.documentElement.appendChild(div);
        bool = form.elements.length === 1;
        div.parentNode.removeChild(div);
        return bool;
      } catch (e) {
        return false;
      }
    });
    methods.init = function(e, lava) {
      if (!Modernizr.formattribute) {
        return $(lava).each(function() {
          $(this).find('*[type="submit"][form]').on("click.lava." + namespace, methods.submitClick);
          return $(this).find('form[id]').on("submit.lava." + namespace, methods.formSubmit);
        });
      }
    };
    methods.submitClick = function(e) {
      var $form_, id;
      e.preventDefault();
      id = $(this).attr('form');
      $form_ = $("#" + id);
      $(this).attr('data-lava-formattribute', 'yes');
      $form_.submit();
      return $(this).removeAttr('data-lava-formattribute');
    };
    methods.formSubmit = function(e) {
      var $form, id;
      e.preventDefault();
      id = $(this).attr('id');
      $form = $(this).clone().removeAttr('id');
      $("*[form='" + id + "']").each(function() {
        var $clone;
        $clone = $(this).clone().removeAttr('form');
        if ($(this).is(':checked')) {
          $clone.attr('checked', 'checked');
        } else {
          $clone.removeAttr('checked');
        }
        return $clone.appendTo($form);
      });
      $form.find('*[data-lava-formattribute="yes"]').each(function() {
        var name, value;
        value = $(this).val();
        if (value === void 0) {
          value = '';
        }
        name = $(this).attr('name');
        if (typeof name !== 'undefined') {
          return $("<input type='hidden' name='" + name + "' value='" + value + "'>").appendTo($form);
        }
      });
      $form.appendTo(document.documentElement);
      $form.submit();
      return $form.remove();
    };
    return lavaBindMethods(methods, namespace);
  })(jQuery, Modernizr);

}).call(this);
